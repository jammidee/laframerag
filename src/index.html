<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lalulla Electra</title>
    <style>
      .title-bar {
        -webkit-app-region: no-drag;
        background: #333;
        color: #fff;
        padding: 8px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
      }

      /* Style the window controls (minimize, maximize, close) */
      .title-bar .window-controls {
        position: absolute;
        top: 0;
        right: 0;
      }

      .title-bar .window-controls button {
        background: none;
        border: none;
        color: #fff;
        margin: 0 5px;
        cursor: pointer;
        font-size: 12px;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0efef !important;

        /* margin-top: 30px;
        padding: 20px; */

      }
  
      .paper-area {
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 20px;
        /* max-width: 800px; */
        width: 100%;
      }
  
      .flex-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        overflow-y: auto;
      }
  
      #welcome {
        margin-bottom: 20px;
      }
  
      #mainform {
        margin-top: 20px;
      }
  
      .flex-container {
        display: flex;
        flex-direction: column;
      }

      form {
        display: flex;
        flex-direction: column;
      }
  
      label {
        margin-bottom: 8px;
      }
  
      input {
        padding: 8px;
        margin-bottom: 16px;
      }
  
      button {
        padding: 12px;
        background-color: #4caf50;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
  
      button:hover {
        background-color: #45a049;
      }



      /* Style for the chat container */
      .chat-container {
        display: flex;
        flex-direction: column;
        height: 80vh; /* Set the height of the chat container */
        overflow-y: auto; /* Enable vertical scrolling when content overflows */
        padding: 10px;
        width: 60%; /* Adjust the width of the chat container */
        margin: 0 auto; /* Center the chat container horizontally */
        border-radius: 10px; /* Add rounded corners */
        background-color: #f8f8f8; /* Add background color */
      }

      /* Thin scrollbar */
      .chat-container::-webkit-scrollbar {
        width: 5px; /* Set the width of the scrollbar */
      }

      /* Track */
      .chat-container::-webkit-scrollbar-track {
        background: #f1f1f1; /* Color of the scrollbar track */
      }

      /* Handle */
      .chat-container::-webkit-scrollbar-thumb {
        background: #c1bfbf; /* Color of the scrollbar handle */
        border-radius: 5px; /* Roundness of the scrollbar handle */
      }

      /* Handle on hover */
      .chat-container::-webkit-scrollbar-thumb:hover {
        background: #555; /* Color of the scrollbar handle on hover */
      }      

      /* Style for the chat messages */
      .chat-messages {
        flex: 1; /* Allow the chat messages to grow and occupy remaining space */
      }

      /* Style for the textbox container */
      .textbox-container {
        padding: 10px;
      }

      /* Style for the textbox */
      .textbox {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .chat-input {
        display: flex;
        align-items: center;
        margin-top: 10px;
      }

      .chat-input input {
        flex: 1; /* Let the input field take remaining space */
        padding: 8px;
        border-radius: 20px; /* Add rounded corners to the input field */
        border: 1px solid #ccc;
        margin-right: 10px; /* Add spacing between input and button */
      }

      .chat-input button {
        padding: 8px 16px;
        background-color: #4caf50;
        color: #fff;
        border: none;
        border-radius: 20px; /* Add rounded corners to the button */
        cursor: pointer;
      }


    </style>
    <!-- <link rel="stylesheet" href="./css/fa.all.min.css" /> -->
    <link rel="stylesheet" href="./css/@fortawesome/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="./css/bootstrap/dist/css/bootstrap.min.css">
  </head>
  <body>

    <!-- Chat container -->
    <div class="chat-container">
      <!-- Chat messages -->
      <div class="chat-messages">
        <div>
          <div id="welcome" class="paper-area">
            <center>
              <h2>üåüWelcome to LaframeRag</h2>
            </center>
            <center>
              <p>
                This serves as a front-end template tailored for desktop development, leveraging ElectronJS within the Lalulla Framework.
              </p>
            </center>
          </div>
        </div>

        <!-- deviceID, driveCSerial, macAddress, macid -->
        <div id="gathered-info" class="paper-area">
          <div>
            <table>
              <tr>
                <td>
                  <p id="wsid"><i class="fas fa-atom"></i>DEVICE ID </p>
                </td>
                <td>
                  <p id="hddid"><i class="fas fa-atom"></i>STORAGE SN </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p id="macaddr"><i class="fas fa-atom"></i>MAC ADDRESS </p>
                </td>
                <td>
                  <p id="servertime"><i class="fas fa-atom"></i>SERVER TIME</p>
                </td>
              </tr>
            </table>
            <!-- <p id="wsid"><i class="fas fa-atom"></i>DEVICE ID </p>
            <p id="hddid"><i class="fas fa-atom"></i>STORAGE SN </p>
            <p id="macaddr"><i class="fas fa-atom"></i>MAC ADDRESS </p>
            <p id="servertime"><i class="fas fa-atom"></i>SERVER TIME</p> -->
            <!-- <p id="machid"><i class="fas fa-atom"></i>MACH ID </p> -->
          </div>
        </div>
        <br>

        <div>
          <div id="hightlight" class="paper-area">
            <div>
              <h4>üíñ Hello World!</h4>
              <p>Welcome to your ElectronJS boilerplate by Lalulla.</p>
              <table>
                <tr>
                  <td>
                    <p>üåü Star: Represents excellence, achievement, or special recognition.</p>
                  </td>
                  <td>
                    <p>üî• Fire: Indicates something that is trendy, hot, or on fire.</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p>üëç Thumbs Up: A positive gesture or agreement.</p>
                  </td>
                  <td>
                    <p>üåà Rainbow: Symbolizes diversity, inclusivity, or positivity.</p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p>‚ù§Ô∏è Red Heart: Represents love, affection, or approval.</p>
                  </td>
                  <td>
                    p><i class="fas fa-atom"></i> Welcome to your Electron application.</p>
                  </td>
                </tr>
              </table>
              <!-- <p>üåü Star: Represents excellence, achievement, or special recognition.</p>
              <p>üî• Fire: Indicates something that is trendy, hot, or on fire.</p>
              <p>üëç Thumbs Up: A positive gesture or agreement.</p>
              <p>üåà Rainbow: Symbolizes diversity, inclusivity, or positivity.</p>
              <p>‚ù§Ô∏è Red Heart: Represents love, affection, or approval.</p>
              <p><i class="fas fa-atom"></i> Welcome to your Electron application.</p> -->
              <button class="btn btn-primary">Click me - a Bootstrap Button</button>
            </div>
          </div>
        </div>

        
        
      </div> <!-- Chat messages -->

      <div class="chat-input">
        <input type="text" id="msgSend" placeholder="Type your message...">
        <button type="button" id="btnSend">Send</button>
      </div>

    </div> <!-- Chat container -->


    <!-- Include your external script file -->
    <script>

      const Swal = require('sweetalert2');

      //Declare library for IPC here
      const { ipcRenderer } = require('electron');
      window.ipcRenderer = ipcRenderer;
      const { electron } = window;

      //================================================
      // Initialize page, happens with the DOM is ready
      //================================================
      ipcRenderer.on('data-to-index', (event, data) => {
        const { title, ...otherdata } = data;
        document.title = title;

        // Run initialization scripts.
        ipcRenderer.send('gather-env-info');

      });

      // const Swal = require('sweetalert2');
      ipcRenderer.on('selected-file', (event, path) => {

        //console.log('Selected file:', path);
        //alert(path);
        Swal.fire({
            title: 'File Dialog',
            text: 'File ' + path + ' has been selected!',
            icon: 'success',
        });

      });

      //Detected machine ID JMD 01/11/2024
      // ipcRenderer.on('machine-id', (event, machid) => {
      //   Swal.fire({
      //       title: 'Device ID Detection',
      //       text: 'Machine ID: ' + machid + '',
      //       icon: 'info',
      //   });
      // });

      //wait for Time event in main process JMD 02/04/2024
      ipcRenderer.on('main-update-time', (event, ptime) => {
        document.getElementById("servertime").innerHTML  = `<i class="fas fa-ethernet"></i> SERVER TIME: ${ptime}`;
      });

      //Detected Environment Information JMD 02/02/2024
      ipcRenderer.on('receive-env-info', (event, info) => {

        const { deviceID, driveCSerial, macAddress, macid, needUpdate, currVersion, currChanges, appUpdatePath, isServerUp } = info;

        document.getElementById("wsid").innerHTML     = `üíñ </i>DEVICE ID: ${deviceID}`;
        document.getElementById("hddid").innerHTML    = `üî• </i>STORAGE SN: ${driveCSerial}`;
        document.getElementById("macaddr").innerHTML  = `<i class="fas fa-atom"></i> MAC ADDRESS: ${macAddress}`;
        //document.getElementById("machid").innerHTML = `MACH ID: ${macid}`;

        if( needUpdate == 1){

          document.getElementById('clientupdates').style.display = "block";
          document.getElementById("clientversion").innerHTML  = `VERSION: ${currVersion}`;
          document.getElementById("clientchanges").innerHTML  = `${currChanges}. You can <a href="${appUpdatePath}">Download Here</a>.`;

        }

        // Swal.fire({
        //     title: 'Gathered Environment',
        //     text: `Device ${deviceID}, Drive Serial ${driveCSerial}, MAC Addr ${macAddress}, Mach ID ${macid}`,
        //     icon: 'info',
        // });

        //================================================
        // If not networked Exit, user can ignore
        // this message and proceed with the application.
        //================================================
        if( macAddress === 'MAC Address not found.' ){
          Swal.fire({
              title: 'Alert',
              text: 'This workstation in not networked. Exiting application!',
              icon: 'warning', // Change 'info' to 'warning' for a warning icon
              showCancelButton: false,
              confirmButtonText: 'OK',
            }).then((result) => {
              if (result.isConfirmed) {

                ipcRenderer.send('quit-to-index');

              }
          });

        } else {

          // Exit if the server is down
          if( isServerUp === 'NO' ){
            Swal.fire({
              title: 'Alert',
              text: 'The Server is down. Terminating the app...',
              icon: 'warning', // Change 'info' to 'warning' for a warning icon
              showCancelButton: false,
              confirmButtonText: 'OK',
            }).then((result) => {
              if (result.isConfirmed) {

                ipcRenderer.send('quit-to-index');

              }
            });
          } else {

            ipcRenderer.send('request-to-login');

          }

        }

        // if(macAddress === 'MAC Address not found.'){
        //   Swal.fire({
        //     title: 'Alert',
        //     text: 'This workstation in not networked. Exiting application!',
        //     icon: 'warning', // Change 'info' to 'warning' for a warning icon
        //     showCancelButton: false,
        //     confirmButtonText: 'OK',
        //   }).then((result) => {
        //     if (result.isConfirmed) {

        //       // Quit the main application
        //       ipcRenderer.send('quit-to-index');

        //     }
        //   });

        // } else {

        //   // Initiate the login sequence.
        //   ipcRenderer.send('request-to-login');

        // }

      });

      //==================================
      // Custom form initialization
      //==================================

      //electron comes from preload
      if( electron.env.ALLOW_LOGIN === 'NO'){

        const welcome = document.getElementById('welcome');
        welcome.style.display = 'block';

        // const iniForm = document.getElementById('mainform');
        // iniForm.style.display = 'block';

      } else {

        const welcome = document.getElementById('welcome');
        welcome.style.display = 'block';

        // const iniForm = document.getElementById('mainform');
        // iniForm.style.display = 'none';

      };

      document.getElementById('btnSend').addEventListener('click', function() {

        sendMessage();

      });

      document.getElementById('msgSend').addEventListener('keypress', function() {
        if (event.keyCode === 13) {
          event.preventDefault();
          sendMessage();
        }
      });

      function sendMessage(){

        var msgInput = document.getElementById('msgSend');
        var message = msgInput.value.trim();

        if (message !== '') {
          var chatMessages    = document.querySelector('.chat-messages');
          var messageElement  = document.createElement('div');
          var elemSpacer      = document.createElement('br');
          var elemLine        = document.createElement('br');

          messageElement.classList.add('paper-area');
          messageElement.textContent = message;

          chatMessages.appendChild(elemSpacer);
          chatMessages.appendChild(messageElement);
          
          // Clear the input field after sending the message
          msgInput.value = '';

          const params = { message };
          const { htmlResp } = ipcRenderer.sendSync('req-ai-answer', params );

          //alert( response );

          var replyElement  = document.createElement('div');
          replyElement.classList.add('paper-area');
          replyElement.innerHTML  = htmlResp;
          chatMessages.appendChild(elemLine);
          chatMessages.appendChild(replyElement);

        };

      };


    </script>

  </body>
</html>
